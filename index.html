<!DOCTYPE html>
<html>
<head>
    <title>Регистрация в RoboCoin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Ваши стили остаются без изменений */
    </style>
</head>
<body>
    <!-- Ваша форма остается без изменений -->
    
    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        
        // Автозаполнение данных из Telegram
        if (Telegram.WebApp.initDataUnsafe?.user) {
            const user = Telegram.WebApp.initDataUnsafe.user;
            document.getElementById('firstName').value = user.first_name || '';
            document.getElementById('lastName').value = user.last_name || '';
        }
        
        document.getElementById('submitBtn').addEventListener('click', function() {
            // Валидация формы (остается без изменений)
            
            if (isValid) {
                const btn = document.getElementById('submitBtn');
                btn.disabled = true;
                btn.textContent = 'Отправка...';
                
                const data = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim() || null,
                    policyAgreed: true
                };
                
                // Важная часть - отправка данных
                try {
                    Telegram.WebApp.sendData(JSON.stringify(data));
                    
                    // Добавляем задержку перед закрытием
                    setTimeout(() => {
                        Telegram.WebApp.close();
                    }, 500);
                    
                } catch (e) {
                    alert('Ошибка отправки: ' + e.message);
                    btn.disabled = false;
                    btn.textContent = 'Зарегистрироваться';
                }
            }
        });
    </script>
</body>
</html>
