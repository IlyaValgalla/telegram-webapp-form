<!DOCTYPE html>
<html>
<head>
    <title>Регистрация</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script async src="https://telegram.org/js/telegram-widget.js?22" 
            data-telegram-login="RrrroboCoins_bot" 
            data-size="large" 
            data-userpic="true"
            data-onauth="onTelegramAuth"
            data-request-access="write"></script>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 100%; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; }
        #auth-container { text-align: center; margin: 20px 0; }
        #form-container { display: none; }
    </style>
</head>
<body>
    <div id="auth-container">
        <p>Сначала авторизуйтесь:</p>
        <!-- Кнопка авторизации Telegram -->
    </div>

    <div id="form-container">
        <input type="text" id="firstName" placeholder="Имя" required>
        <input type="text" id="lastName" placeholder="Фамилия" required>
        <input type="email" id="email" placeholder="Email" required>
        <input type="tel" id="phone" placeholder="Телефон">
        
        <button id="submitBtn">Зарегистрироваться</button>
    </div>

    <script>
        // Обработка авторизации
        function onTelegramAuth(user) {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('form-container').style.display = 'block';
            console.log("Авторизован:", user);
            
            // Можно заполнить некоторые поля автоматически
            document.getElementById('firstName').value = user.first_name || '';
            document.getElementById('lastName').value = user.last_name || '';
        }

        // Отправка формы
        document.getElementById('submitBtn').addEventListener('click', function() {
            const data = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                telegramData: window.Telegram.WebApp.initDataUnsafe.user
            };
            
            if(window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.sendData(JSON.stringify(data));
                Telegram.WebApp.close();
            } else {
                alert("Ошибка: форма не в Telegram WebApp");
            }
        });

        // Инициализация WebApp
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>
